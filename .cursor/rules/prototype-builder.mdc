---
description: "Build human-centric AI prototypes with creative exploration"
globs: ["elephant-ai/web/src/components/prototypes/**/*"]
alwaysApply: false
---

# Prototype Builder Rules

Build prototypes that explore multiple creative directions, meet human-centric AI design standards, and enable informed design decisions.

## CRITICAL: Load Design System First

**Before building ANY component:**

1. Read `.interface-design/system.md` (visual craft system)
2. State design choices explicitly before coding
3. Apply established patterns consistently
4. Offer to save new patterns after building

```markdown
**Design checkpoint:**
âœ“ Loaded: .interface-design/system.md
âœ“ Direction: Sophistication & Trust
âœ“ Spacing: 4px grid
âœ“ Depth: borders-only
âœ“ Component patterns: loaded

**Building: [ComponentName]**
â”œâ”€â”€ Spacing: p-4 (16px), gap-2 (8px)
â”œâ”€â”€ Depth: border border-border rounded-lg
â”œâ”€â”€ Surface: bg-card
â””â”€â”€ Interactive: hover:bg-muted/50
```

See `interface-design.mdc` for full visual craft system.

---

## Design Principles (Always Apply)

### Trust Before Automation
- New features start as suggestions, not automations
- Show receipts (evidence) for every AI decision
- Make confidence levels explicit
- Graceful failure > silent failure

### Emotional Design
- **Visceral**: Polish signals investment and care
- **Behavioral**: Consistent, predictable interactions
- **Reflective**: User feels augmented, not replaced

### Persona Awareness
- **Reps fear**: Surveillance, replacement, embarrassment
- **Managers fear**: Losing touch, surveillance culture
- **RevOps fear**: Ungovernable AI, lack of auditability

## Creative Exploration (Required)

For each major component, create 2-3 creative directions:

| Direction | User Control | Trust Required | Best Persona |
|-----------|-------------|----------------|--------------|
| Option A | Maximum | Low | New users, skeptics |
| Option B | Balanced | Medium | Most users |
| Option C | Minimal | High | Power users |

## Required AI States

Every AI feature needs ALL of these states in Storybook:

```typescript
// Required story exports
export const Loading: Story = { ... };
export const LoadingLong: Story = { ... };  // 3+ seconds
export const Success: Story = { ... };
export const Error: Story = { ... };
export const LowConfidence: Story = { ... };
export const Empty: Story = { ... };
```

### State Design Specs

| State | Visual | Copy | Animation |
|-------|--------|------|-----------|
| Loading (short) | Spinner | None | Pulse |
| Loading (long) | Progress stages | "Analyzing..." | Transitions |
| Success | Check, muted | Brief, affirming | Scale+fade 150ms |
| Error | Warning icon | Honest + solution | Gentle shake |
| Low Confidence | Muted, dotted | "I think..." | None |
| Empty | Illustration | Encouraging | Fade in |

## Component Structure (Versioned)

**ALWAYS** create prototypes in versioned subfolders, starting with `v1/`:

```
elephant-ai/web/src/components/prototypes/[Initiative]/
â”œâ”€â”€ index.ts                          # Re-exports latest version
â”œâ”€â”€ v1/
â”‚   â”œâ”€â”€ [ComponentName].tsx
â”‚   â”œâ”€â”€ [ComponentName].stories.tsx   # All options + all states
â”‚   â”œâ”€â”€ [ComponentName].docs.mdx      # Design rationale
â”‚   â”œâ”€â”€ types.ts
â”‚   â””â”€â”€ index.ts                      # Version-specific exports
â”œâ”€â”€ v2/                               # After first iteration
â”‚   â””â”€â”€ ...
â””â”€â”€ v3/                               # After user testing
    â””â”€â”€ ...
```

**Root index.ts pattern:**
```typescript
// Re-export the latest stable version
export * from './v1';  // or './v2', './v3' after iterations
```

## Story Organization

```typescript
const meta = {
  title: 'Prototypes/[Initiative]/v1/[ComponentName]',  // Include version!
  component: ComponentName,
};

// Creative Options
export const OptionA_MaxControl: Story = { ... };
export const OptionB_Balanced: Story = { ... };
export const OptionC_Efficient: Story = { ... };

// Required States
export const Loading: Story = { ... };
export const LoadingLong: Story = { ... };
export const Success: Story = { ... };
export const Error: Story = { ... };
export const LowConfidence: Story = { ... };
export const Empty: Story = { ... };
```

**Storybook sidebar structure:**
```
Prototypes/
â”œâ”€â”€ HubSpotConfig/
â”‚   â”œâ”€â”€ v1/
â”‚   â”‚   â””â”€â”€ FieldMapper
â”‚   â”œâ”€â”€ v2/
â”‚   â”‚   â””â”€â”€ FieldMapper
â”‚   â””â”€â”€ v3/
â”‚       â””â”€â”€ FieldMapper
â””â”€â”€ SettingsRedesign/
    â”œâ”€â”€ v1/
    â”‚   â””â”€â”€ PrivacyPanel
    â””â”€â”€ v2/
        â””â”€â”€ PrivacyPanel
```

## Design Checklists

### Before Coding
- [ ] Read PRD and Design Brief
- [ ] Understand which personas this serves
- [ ] Identify trust level required
- [ ] Plan 2-3 creative directions

### During Build
- [ ] All AI states implemented
- [ ] Receipts/evidence visible for AI decisions
- [ ] Confidence levels shown appropriately
- [ ] Error recovery path exists
- [ ] Undo available for AI actions

### Before Review
- [ ] Keyboard navigable
- [ ] Screen reader compatible
- [ ] Color contrast sufficient
- [ ] No surveillance vibes
- [ ] User feels capable, not dependent

## Versioning

**Use folder-based versioning** (required, not optional):

```
[Initiative]/
â”œâ”€â”€ v1/    â† Initial exploration (created by /proto)
â”œâ”€â”€ v2/    â† After stakeholder feedback (created by /iterate)
â”œâ”€â”€ v3/    â† After user testing (created by /iterate)
â””â”€â”€ ...
```

**Story titles include version:**
```typescript
const meta = {
  title: 'Prototypes/[Initiative]/v1/[ComponentName]',
  component: ComponentName,
};
```

This enables:
- Side-by-side comparison in Storybook
- Full history preservation
- Easy navigation in sidebar

## Anti-Patterns

ğŸš© **Single option** - Always explore 2-3 directions
ğŸš© **Missing states** - All AI states required
ğŸš© **Confident wrongness** - Show uncertainty appropriately
ğŸš© **Silent failure** - Always explain what went wrong
ğŸš© **Surveillance vibes** - "Helps you" not "reports on you"
ğŸš© **Replacement framing** - Augment, don't replace
ğŸš© **No receipts** - Show evidence for AI decisions

## Tech Stack

- React 18 + TypeScript (strict mode)
- Tailwind CSS
- shadcn/ui from `@/components/ui/`
- Functional components with hooks

## Storybook Commands

```bash
cd elephant-ai
npm run storybook -w web    # http://localhost:6006
npm run build-storybook -w web
```

## Build & Deploy (REQUIRED)

**Every prototype MUST be deployed to Chromatic for sharing:**

### Step 1: Build (Catch Errors)
```bash
cd elephant-ai
npm run build-storybook -w web
```

If build fails: Fix TypeScript/import errors before proceeding.

### Step 2: Deploy to Chromatic
```bash
cd elephant-ai
npm run chromatic
```

### Step 3: Capture the URL
Chromatic outputs URLs like:
- **Storybook URL**: `https://<hash>--<appId>.chromatic.com/`
- **Build URL**: `https://www.chromatic.com/build?appId=...&number=XX`

**Include the Chromatic URL in your response** - this is how stakeholders will view the prototype.

## After Building

Document in `.pm-workspace/initiatives/[project]/prototype-notes.md`:

1. **Chromatic URL** (required - for stakeholder sharing)
2. Options created with rationale
3. Comparison table
4. Recommended direction
5. Open questions for review
6. Trust/emotion assessment for each option

## Context Testing

Test prototypes in real context:
- `workflows/WorkflowNodeSheet` - Panel context
- Embed prototype as children
- Verify it feels native
