---
description: "Build human-centric AI prototypes with creative exploration"
globs: ["elephant-ai/web/src/components/prototypes/**/*"]
alwaysApply: false
---

# Prototype Builder Rules

Build prototypes that explore multiple creative directions, meet human-centric AI design standards, and enable informed design decisions.

## CRITICAL: Load Design System First

**Before building ANY component:**

1. Read `.interface-design/system.md` (visual craft system)
2. State design choices explicitly before coding
3. Apply established patterns consistently
4. Offer to save new patterns after building

```markdown
**Design checkpoint:**
‚úì Loaded: .interface-design/system.md
‚úì Direction: Sophistication & Trust
‚úì Spacing: 4px grid
‚úì Depth: borders-only
‚úì Component patterns: loaded

**Building: [ComponentName]**
‚îú‚îÄ‚îÄ Spacing: p-4 (16px), gap-2 (8px)
‚îú‚îÄ‚îÄ Depth: border border-border rounded-lg
‚îú‚îÄ‚îÄ Surface: bg-card
‚îî‚îÄ‚îÄ Interactive: hover:bg-muted/50
```

See `interface-design.mdc` for full visual craft system.

---

## Design Principles (Always Apply)

### Trust Before Automation
- New features start as suggestions, not automations
- Show receipts (evidence) for every AI decision
- Make confidence levels explicit
- Graceful failure > silent failure

### Emotional Design
- **Visceral**: Polish signals investment and care
- **Behavioral**: Consistent, predictable interactions
- **Reflective**: User feels augmented, not replaced

### Persona Awareness
- **Reps fear**: Surveillance, replacement, embarrassment
- **Managers fear**: Losing touch, surveillance culture
- **RevOps fear**: Ungovernable AI, lack of auditability

## Creative Exploration (Required)

For each major component, create 2-3 creative directions:

| Direction | User Control | Trust Required | Best Persona |
|-----------|-------------|----------------|--------------|
| Option A | Maximum | Low | New users, skeptics |
| Option B | Balanced | Medium | Most users |
| Option C | Minimal | High | Power users |

## Required AI States

Every AI feature needs ALL of these states in Storybook:

```typescript
// Required story exports
export const Loading: Story = { ... };
export const LoadingLong: Story = { ... };  // 3+ seconds
export const Success: Story = { ... };
export const Error: Story = { ... };
export const LowConfidence: Story = { ... };
export const Empty: Story = { ... };
```

### State Design Specs

| State | Visual | Copy | Animation |
|-------|--------|------|-----------|
| Loading (short) | Spinner | None | Pulse |
| Loading (long) | Progress stages | "Analyzing..." | Transitions |
| Success | Check, muted | Brief, affirming | Scale+fade 150ms |
| Error | Warning icon | Honest + solution | Gentle shake |
| Low Confidence | Muted, dotted | "I think..." | None |
| Empty | Illustration | Encouraging | Fade in |

---

## REQUIRED: Interactive User Journey (Flow Stories)

> ‚ö†Ô∏è **Every prototype MUST include at least one flow story** that walks through the complete user journey.
> Individual states are NOT enough - designers need to see how the experience unfolds over time.

### Why Flows Are Required

| What States Show | What Flows Show |
|------------------|-----------------|
| Isolated snapshots | Connected experience |
| "Here's the error state" | "User sees error, clicks retry, sees loading, then success" |
| Component in one moment | Component through time |
| **Necessary but not sufficient** | **The full picture** |

### Flow Story Requirements

Every prototype needs a `Flow_[JourneyName]` story that:

1. **Shows the complete user journey** from trigger to outcome
2. **Is interactive** - user can click through steps
3. **Includes transitions** between states
4. **Covers happy path AND at least one unhappy path**

### Flow Story Pattern

```typescript
// Required: At least one flow story per prototype
export const Flow_HappyPath: Story = {
  render: () => <InteractiveJourney scenario="happy" />,
  parameters: {
    docs: {
      description: {
        story: `
**User Journey: Happy Path**

1. User arrives ‚Üí sees initial state
2. User takes action ‚Üí loading appears
3. Processing completes ‚Üí success state
4. User continues ‚Üí next step available

Click through to experience the full flow.
        `,
      },
    },
  },
};

export const Flow_ErrorRecovery: Story = {
  render: () => <InteractiveJourney scenario="error-recovery" />,
  parameters: {
    docs: {
      description: {
        story: `
**User Journey: Error Recovery**

1. User arrives ‚Üí sees initial state
2. User takes action ‚Üí loading appears  
3. Error occurs ‚Üí error state with recovery option
4. User retries ‚Üí loading appears
5. Success ‚Üí happy outcome

Click through to experience error handling.
        `,
      },
    },
  },
};
```

### Interactive Journey Component Pattern

Create an `InteractiveJourney` wrapper for flow stories:

```typescript
// [ComponentName]Journey.tsx
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { ComponentName } from './ComponentName';

type JourneyStep = 'initial' | 'action' | 'loading' | 'success' | 'error';

interface InteractiveJourneyProps {
  scenario: 'happy' | 'error-recovery' | 'empty-to-populated';
}

export function InteractiveJourney({ scenario }: InteractiveJourneyProps) {
  const [step, setStep] = useState<JourneyStep>('initial');
  
  const journeySteps = getJourneySteps(scenario);
  const currentStepIndex = journeySteps.indexOf(step);
  
  return (
    <div className="space-y-4">
      {/* Journey Progress */}
      <div className="flex items-center gap-2 p-4 bg-muted rounded-lg">
        <span className="text-sm font-medium">Journey:</span>
        {journeySteps.map((s, i) => (
          <span 
            key={s}
            className={cn(
              "px-2 py-1 rounded text-xs",
              i === currentStepIndex ? "bg-primary text-primary-foreground" : "bg-background"
            )}
          >
            {i + 1}. {s}
          </span>
        ))}
      </div>
      
      {/* The Actual Component */}
      <ComponentName state={step} />
      
      {/* Journey Controls */}
      <div className="flex gap-2 p-4 border-t">
        <Button 
          variant="outline" 
          onClick={() => setStep(journeySteps[Math.max(0, currentStepIndex - 1)])}
          disabled={currentStepIndex === 0}
        >
          ‚Üê Previous
        </Button>
        <Button 
          onClick={() => setStep(journeySteps[Math.min(journeySteps.length - 1, currentStepIndex + 1)])}
          disabled={currentStepIndex === journeySteps.length - 1}
        >
          Next ‚Üí
        </Button>
        <Button variant="ghost" onClick={() => setStep('initial')}>
          Reset
        </Button>
      </div>
      
      {/* Step Explanation */}
      <div className="p-4 bg-muted/50 rounded-lg text-sm">
        <strong>Current Step:</strong> {getStepExplanation(step, scenario)}
      </div>
    </div>
  );
}
```

### Minimum Flow Coverage

| Prototype Type | Required Flows |
|----------------|----------------|
| Simple feature | 1 flow (happy path) |
| AI feature | 2 flows (happy + error recovery) |
| Complex workflow | 3+ flows (happy + error + edge cases) |

### Flow Story Checklist

Before design handoff, verify:

- [ ] At least one `Flow_*` story exists
- [ ] Happy path flow is complete (start ‚Üí success)
- [ ] Error recovery flow exists (for AI features)
- [ ] Steps can be clicked through (interactive)
- [ ] Transitions are visible (not just jump cuts)
- [ ] Step explanations describe what user sees/does

## Component Structure (Versioned)

**ALWAYS** create prototypes in versioned subfolders, starting with `v1/`:

```
elephant-ai/web/src/components/prototypes/[Initiative]/
‚îú‚îÄ‚îÄ index.ts                          # Re-exports latest version
‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îú‚îÄ‚îÄ [ComponentName].tsx
‚îÇ   ‚îú‚îÄ‚îÄ [ComponentName].stories.tsx   # All options + all states
‚îÇ   ‚îú‚îÄ‚îÄ [ComponentName].docs.mdx      # Design rationale
‚îÇ   ‚îú‚îÄ‚îÄ types.ts
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                      # Version-specific exports
‚îú‚îÄ‚îÄ v2/                               # After first iteration
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ v3/                               # After user testing
    ‚îî‚îÄ‚îÄ ...
```

**Root index.ts pattern:**
```typescript
// Re-export the latest stable version
export * from './v1';  // or './v2', './v3' after iterations
```

## Story Organization

```typescript
const meta = {
  title: 'Prototypes/[Initiative]/v1/[ComponentName]',  // Include version!
  component: ComponentName,
};

// Creative Options
export const OptionA_MaxControl: Story = { ... };
export const OptionB_Balanced: Story = { ... };
export const OptionC_Efficient: Story = { ... };

// Required States
export const Loading: Story = { ... };
export const LoadingLong: Story = { ... };
export const Success: Story = { ... };
export const Error: Story = { ... };
export const LowConfidence: Story = { ... };
export const Empty: Story = { ... };
```

**Storybook sidebar structure:**
```
Prototypes/
‚îú‚îÄ‚îÄ HubSpotConfig/
‚îÇ   ‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FieldMapper
‚îÇ   ‚îú‚îÄ‚îÄ v2/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FieldMapper
‚îÇ   ‚îî‚îÄ‚îÄ v3/
‚îÇ       ‚îî‚îÄ‚îÄ FieldMapper
‚îî‚îÄ‚îÄ SettingsRedesign/
    ‚îú‚îÄ‚îÄ v1/
    ‚îÇ   ‚îî‚îÄ‚îÄ PrivacyPanel
    ‚îî‚îÄ‚îÄ v2/
        ‚îî‚îÄ‚îÄ PrivacyPanel
```

## Design Checklists

### Before Coding
- [ ] Read PRD and Design Brief
- [ ] Understand which personas this serves
- [ ] Identify trust level required
- [ ] Plan 2-3 creative directions

### During Build
- [ ] All AI states implemented
- [ ] Receipts/evidence visible for AI decisions
- [ ] Confidence levels shown appropriately
- [ ] Error recovery path exists
- [ ] Undo available for AI actions

### Before Review
- [ ] Keyboard navigable
- [ ] Screen reader compatible
- [ ] Color contrast sufficient
- [ ] No surveillance vibes
- [ ] User feels capable, not dependent

## Versioning

**Use folder-based versioning** (required, not optional):

```
[Initiative]/
‚îú‚îÄ‚îÄ v1/    ‚Üê Initial exploration (created by /proto)
‚îú‚îÄ‚îÄ v2/    ‚Üê After stakeholder feedback (created by /iterate)
‚îú‚îÄ‚îÄ v3/    ‚Üê After user testing (created by /iterate)
‚îî‚îÄ‚îÄ ...
```

**Story titles include version:**
```typescript
const meta = {
  title: 'Prototypes/[Initiative]/v1/[ComponentName]',
  component: ComponentName,
};
```

This enables:
- Side-by-side comparison in Storybook
- Full history preservation
- Easy navigation in sidebar

## Anti-Patterns

üö© **Single option** - Always explore 2-3 directions
üö© **Missing states** - All AI states required
üö© **Confident wrongness** - Show uncertainty appropriately
üö© **Silent failure** - Always explain what went wrong
üö© **Surveillance vibes** - "Helps you" not "reports on you"
üö© **Replacement framing** - Augment, don't replace
üö© **No receipts** - Show evidence for AI decisions

## Tech Stack

- React 18 + TypeScript (strict mode)
- Tailwind CSS
- shadcn/ui from `@/components/ui/`
- Functional components with hooks

## Storybook Commands

```bash
cd elephant-ai
npm run storybook -w web    # http://localhost:6006
npm run build-storybook -w web
```

## Build & Deploy (REQUIRED - DO NOT SKIP)

> ‚õî **BLOCKING REQUIREMENT**: Every prototype MUST be deployed to Chromatic.
> Your response is INCOMPLETE without a Chromatic URL.

### Step 1: Build Storybook
```bash
cd elephant-ai && npm run build-storybook -w web
```
Fix any errors before proceeding.

### Step 2: Deploy to Chromatic
```bash
cd elephant-ai && npm run chromatic
```

### Step 3: Capture & Include URL

**You MUST extract these from the Chromatic output:**
- `storybookUrl` ‚Üí Include in your response (shareable link)
- `buildUrl` ‚Üí Include in your response (build details)

**Known issue**: "React error #299" may appear but the Storybook URL still works.

### Pre-Response Checklist
Before responding, verify:
- [ ] Build passed
- [ ] Chromatic deployed  
- [ ] URL captured
- [ ] URL included in response

**If URL is missing, your response is incomplete. Go run Chromatic.**

## After Building

Document in `pm-workspace-docs/initiatives/[project]/prototype-notes.md`:

1. **Chromatic URL** (required - for stakeholder sharing)
2. Options created with rationale
3. Comparison table
4. Recommended direction
5. Open questions for review
6. Trust/emotion assessment for each option

## Context Testing

Test prototypes in real context:
- `workflows/WorkflowNodeSheet` - Panel context
- Embed prototype as children
- Verify it feels native
